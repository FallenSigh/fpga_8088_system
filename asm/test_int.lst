Microsoft (R) Macro Assembler Version 6.14.8444		    12/18/25 12:49:42
test_int.asm						     Page 1 - 1


				.model tiny
 0000				        .code
				        .8086

 = FC00				        ROM_SEGMENT EQU 0FC00h
 = 0020				        PIC_ICW1        EQU     20H
 = 0021				        PIC_ICW2        EQU     21H
 = 0021				        PIC_ICW3        EQU     21H
 = 0021				        PIC_ICW4        EQU     21H
				        ; ROM: 0xFC000-0xFFFFF
				        ; RAM: 0x00000-0x03FFF
				        org     0h

 0000				IR0_ISR PROC FAR
 0000  50			        PUSH AX
 0001  52			        PUSH DX

 0002  B0 01			        MOV AL, 01H
 0004  E6 56			        OUT  56H, AL

				        ; ===============================
				        ; 2. 发送 EOI（必须）
				        ; ===============================
 0006  B0 20			        MOV  AL, 20H             ; Non-specific EOI
 0008  E6 20			        OUT  20H, AL             ; 写 8259 命令端口

				        ; ===============================
				        ; 3. 恢复现场并返回
				        ; ===============================
 000A  5A			        POP  DX
 000B  58			        POP  AX
 000C  CF			        IRET
 000D				    IR0_ISR ENDP

 000D				start:
 000D  FA			        cli                     ; 初始化期间关闭中断

 000E  B8 0000			        mov     ax, 0000h
 0011  8E D8			        mov     ds, ax
 0013  8E C0			        mov     es, ax
 0015  8E D0			        mov     ss, ax

 0017  BC 4000			        mov     sp, 04000h      ; SP 指向 0x0000:0x4000 (RAM 顶端)

				        ; 1. 初始化 8259A (ICW1)
				        ; D4=1: 需要ICW4
				        ; D1=0: 单片 (Single PIC) 模式
				        ; D0=1: 边缘触发 (Edge-triggered) 模式
 001A  B0 13			        MOV AL, 13H         ; ICW1: 00010011B
 001C  BA 0020			        MOV DX, PIC_ICW1
 001F  EE			        OUT DX, AL         ; 发送给 8259A 的命令端口 (20H)

				        ; 2. 设置 8259A 的中断向量基地址 (ICW2)
				        ; T7-T3: 中断向量号的高5位。这里设置为 20H (32)
 0020  B0 20			        MOV AL, 20H         ; 中断向量起始地址 20H
 0022  E6 21			        OUT PIC_ICW2, AL         ; 发送给 8259A 的数据端口 (21H)

				        ; 3. 配置 8259A 的级联信息 (ICW3)
				        ; 在单片模式下，ICW3 无效，但通常为了完整性，会发送一个零值。
				        ; 有些系统设计可能允许跳过此步，但为了兼容性，保留它。
 0024  B0 09			        MOV AL, 09H         ; ICW3: 在单片模式下，该值无关紧要
 0026  E6 21			        OUT PIC_ICW3, AL         ; 发送给 8259A 的数据端口

				        ; 安装中断向量
				        ; 1. 设置偏移地址 (Offset)
 0028  BB 0080			        MOV BX, 80H
 002B  B8 0000 R		        MOV AX, OFFSET IR0_ISR ; 获取 IR0_ISR 的偏移地址
 002E  89 07			        MOV WORD PTR [BX], AX
				        ; 2. 设置段地址 (Segment)
 0030  BB 0082			        MOV BX, 82H
 0033  B8 FC00			        MOV AX, ROM_SEGMENT ; 设置段地址 FC00H
 0036  89 07			        MOV WORD PTR [BX], AX

 0038  FB			        STI                         ; 开中断

 0039				stop_here:
 0039  EB FE			        jmp     stop_here

				        ; --- GW8088 BOOT CODE (Reset Vector) ---
				        org     03ff0h

 3FF0  EA			        db      0EAh
 3FF1  000D R			        dw      offset start
 3FF3  FC00			        dw      ROM_SEGMENT

				        org     03fffh
 3FFF  00			        db      0

				        end
Microsoft (R) Macro Assembler Version 6.14.8444		    12/18/25 12:49:42
test_int.asm						     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

DGROUP . . . . . . . . . . . . .	GROUP
_TEXT  . . . . . . . . . . . . .	16 Bit	 4000	  Word	  Public  'CODE'	
_DATA  . . . . . . . . . . . . .	16 Bit	 0000	  Word	  Public  'DATA'	


Procedures,  parameters and locals:

                N a m e                 Type     Value    Attr

IR0_ISR  . . . . . . . . . . . .	P Far	 0000	  _TEXT	Length= 000D Public


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 0000h	 
@DataSize  . . . . . . . . . . .	Number	 0000h	 
@Interface . . . . . . . . . . .	Number	 0000h	 
@Model . . . . . . . . . . . . .	Number	 0001h	 
@code  . . . . . . . . . . . . .	Text   	 DGROUP
@data  . . . . . . . . . . . . .	Text   	 DGROUP
@fardata?  . . . . . . . . . . .	Text   	 FAR_BSS
@fardata . . . . . . . . . . . .	Text   	 FAR_DATA
@stack . . . . . . . . . . . . .	Text   	 DGROUP
PIC_ICW1 . . . . . . . . . . . .	Number	 0020h	 
PIC_ICW2 . . . . . . . . . . . .	Number	 0021h	 
PIC_ICW3 . . . . . . . . . . . .	Number	 0021h	 
PIC_ICW4 . . . . . . . . . . . .	Number	 0021h	 
ROM_SEGMENT  . . . . . . . . . .	Number	 FC00h	 
start  . . . . . . . . . . . . .	L Near	 000D	  _TEXT	
stop_here  . . . . . . . . . . .	L Near	 0039	  _TEXT	

	   0 Warnings
	   0 Errors
