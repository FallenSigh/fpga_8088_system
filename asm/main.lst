Microsoft (R) Macro Assembler Version 6.14.8444		    12/20/25 19:22:14
main.asm						     Page 1 - 1


				.model tiny
 0000				        .code
				        .8086

				        ; ROM: 0xFC000-0xFFFFF
				        ; RAM: 0x00000-0x03FFF
 = FC00				        ROM_SEGMENT EQU 0FC00h
				        ; 8259 中断控制器
 = 0020				        PIC_ICW1        EQU     20H
 = 0021				        PIC_ICW2        EQU     21H
 = 0021				        PIC_ICW3        EQU     21H
 = 0021				        PIC_ICW4        EQU     21H
				        ; 8254 定时器
 = 0040				        PIT_CNT0        EQU     40H
 = 0041				        PIT_CNT1        EQU     41H
 = 0042				        PIT_CNT2        EQU     42H
 = 0043				        PIT_CTRL        EQU     43H
				        ; 8255
 = 0060				        PPI_PORTA       EQU     60H
 = 0061				        PPI_PORTB       EQU     61H
 = 0062				        PPI_PORTC       EQU     62H
 = 0063				        PPI_CTRL        EQU     63H

				        org     0h

 0000				IR0_ISR PROC FAR
 0000  50			        PUSH AX
 0001  52			        PUSH DX

				        ; 向testout 写入1
 0002  B0 01			        MOV AL, 01H
 0004  E6 56			        OUT  56H, AL

				        ; 发送 EOI（必须）
 0006  B0 20			        MOV  AL, 20H             ; Non-specific EOI
 0008  E6 20			        OUT  20H, AL             ; 写 8259 命令端口

				        ; 恢复现场并返回
 000A  5A			        POP  DX
 000B  58			        POP  AX
 000C  CF			        IRET
 000D				    IR0_ISR ENDP

 000D				start:
 000D  FA			        cli                     ; 初始化期间关闭中断

 000E  B8 0000			        mov     ax, 0000h
 0011  8E D8			        mov     ds, ax
 0013  8E C0			        mov     es, ax
 0015  8E D0			        mov     ss, ax

 0017  BC 4000			        mov     sp, 04000h      ; SP 指向 0x0000:0x4000 (RAM 顶端)

				        ; 初始化 8259A
 001A  B0 13			        MOV AL, 13H         ; ICW1: 00010011B
 001C  BA 0020			        MOV DX, PIC_ICW1
 001F  EE			        OUT DX, AL

 0020  B0 20			        MOV AL, 20H         ; 中断向量起始地址 20H
 0022  E6 21			        OUT PIC_ICW2, AL

 0024  B0 09			        MOV AL, 09H         ; ICW3: 在单片模式下，该值无关紧要
 0026  E6 21			        OUT PIC_ICW3, AL         ; 发送给 8259A 的数据端口

				        ; 安装中断向量
 0028  BB 0080			        MOV BX, 80H
 002B  B8 0000 R		        MOV AX, OFFSET IR0_ISR ; 获取 IR0_ISR 的偏移地址
 002E  89 07			        MOV WORD PTR [BX], AX  ; IP
 0030  BB 0082			        MOV BX, 82H
 0033  B8 FC00			        MOV AX, ROM_SEGMENT ; 设置段地址 FC00H
 0036  89 07			        MOV WORD PTR [BX], AX  ; CS

				        ; 初始化 8254
 0038  BA 0043			        mov     dx, PIT_CTRL
 003B  B0 36			        mov     al, 36h
 003D  EE			        out     dx, al

 003E  BA 0040			        mov     dx, PIT_CNT0
 0041  B0 E8			        mov     al, 232
 0043  EE			        out     dx, al          ; LSB
 0044  B0 03			        mov     al, 3
 0046  EE			        out     dx, al          ; MSB

 0047  FB			        sti                         ; 开中断

 0048  BA 0063			        mov     dx, PPI_CTRL
 004B  B0 90			        mov     al, 90h
 004D  EE			        out     dx, al

				        ; 从端口 A 读取数据
 004E  BA 0060			        mov     dx, PPI_PORTA
 0051  EC			        in      al, dx

				        ; 输出到端口 B
 0052  BA 0061			        mov     dx, PPI_PORTB
 0055  EE			        out     dx, al

				        ; 加 1
 0056  FE C0			        inc     al

				        ; 输出到端口 C
 0058  BA 0062			        mov     dx, PPI_PORTC
 005B  EE			        out     dx, al

 005C				stop_here:
 005C  EB FE			        jmp     stop_here

				        ; --- GW8088 BOOT CODE (Reset Vector) ---
				        org     03ff0h

 3FF0  EA			        db      0EAh
 3FF1  000D R			        dw      offset start
 3FF3  FC00			        dw      ROM_SEGMENT

				        org     03fffh
 3FFF  00			        db      0

				        end
Microsoft (R) Macro Assembler Version 6.14.8444		    12/20/25 19:22:14
main.asm						     Symbols 2 - 1




Segments and Groups:

                N a m e                 Size     Length   Align   Combine Class

DGROUP . . . . . . . . . . . . .	GROUP
_TEXT  . . . . . . . . . . . . .	16 Bit	 4000	  Word	  Public  'CODE'	
_DATA  . . . . . . . . . . . . .	16 Bit	 0000	  Word	  Public  'DATA'	


Procedures,  parameters and locals:

                N a m e                 Type     Value    Attr

IR0_ISR  . . . . . . . . . . . .	P Far	 0000	  _TEXT	Length= 000D Public


Symbols:

                N a m e                 Type     Value    Attr

@CodeSize  . . . . . . . . . . .	Number	 0000h	 
@DataSize  . . . . . . . . . . .	Number	 0000h	 
@Interface . . . . . . . . . . .	Number	 0000h	 
@Model . . . . . . . . . . . . .	Number	 0001h	 
@code  . . . . . . . . . . . . .	Text   	 DGROUP
@data  . . . . . . . . . . . . .	Text   	 DGROUP
@fardata?  . . . . . . . . . . .	Text   	 FAR_BSS
@fardata . . . . . . . . . . . .	Text   	 FAR_DATA
@stack . . . . . . . . . . . . .	Text   	 DGROUP
PIC_ICW1 . . . . . . . . . . . .	Number	 0020h	 
PIC_ICW2 . . . . . . . . . . . .	Number	 0021h	 
PIC_ICW3 . . . . . . . . . . . .	Number	 0021h	 
PIC_ICW4 . . . . . . . . . . . .	Number	 0021h	 
PIT_CNT0 . . . . . . . . . . . .	Number	 0040h	 
PIT_CNT1 . . . . . . . . . . . .	Number	 0041h	 
PIT_CNT2 . . . . . . . . . . . .	Number	 0042h	 
PIT_CTRL . . . . . . . . . . . .	Number	 0043h	 
PPI_CTRL . . . . . . . . . . . .	Number	 0063h	 
PPI_PORTA  . . . . . . . . . . .	Number	 0060h	 
PPI_PORTB  . . . . . . . . . . .	Number	 0061h	 
PPI_PORTC  . . . . . . . . . . .	Number	 0062h	 
ROM_SEGMENT  . . . . . . . . . .	Number	 FC00h	 
start  . . . . . . . . . . . . .	L Near	 000D	  _TEXT	
stop_here  . . . . . . . . . . .	L Near	 005C	  _TEXT	

	   0 Warnings
	   0 Errors
